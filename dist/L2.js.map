{"version":3,"file":"L2.js","sourceRoot":"","sources":["../L2-Lib/L2.ts"],"names":[],"mappings":"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","sourcesContent":["import jsDAL from \"./L2.DAL\"\r\n\r\n// TODO: Implement DI-based messaging service?\r\n\r\nexport class toastr {\r\n    static info(msg, title) {\r\n        alert(\"info:\" + msg);\r\n    }\r\n\r\n    static success(msg, title) {\r\n        alert(\"success:\" + msg);\r\n    }\r\n\r\n    static warning(msg, title) {\r\n        alert(\"warning:\" + msg);\r\n    }\r\n\r\n    static error(msg) {\r\n        alert(\"error:\" + msg);\r\n    }\r\n}\r\n\r\nexport interface IL2OutputMessageHandler {\r\n    info(msg: string, title?: string);\r\n\r\n    success(msg: string, title?: string);\r\n\r\n    warning(msg: string, title?: string);\r\n\r\n    exclamation(msg: string, title?: string);\r\n\r\n    confirm(msg: string, title?: string) : Promise<boolean>;\r\n\r\n    handleException(error: Error | ExceptionInformation | string, additionalKVs?: Object);\r\n\r\n}\r\n\r\nexport class BrowserStore {\r\n    constructor() {\r\n\r\n    }\r\n\r\n    public static local<T>(key: string, value?: T): T {\r\n        return BrowserStore.processRequest<T>(window.localStorage, key, value, \"Local\");\r\n    }\r\n\r\n    public static session<T>(key: string, value?: T): T {\r\n        return BrowserStore.processRequest<T>(window.sessionStorage, key, value, \"Session\");\r\n    }\r\n\r\n    //    private static removeItemVal = {};\r\n\r\n    public static removeSessionItem = function (key) {\r\n        window.sessionStorage.removeItem(key);\r\n    }\r\n    public static removeLocalItem = function (key) {\r\n        window.localStorage.removeItem(key);\r\n    }\r\n\r\n    private static processRequest<T>(store: Storage, key: string, value: T, storeName: string): T {\r\n\r\n        var obj: any;\r\n\r\n        // if value is not specified at all assume we are doing a get.\r\n        if (value === undefined) {\r\n            try {\r\n                // GET\r\n                obj = store.getItem(key);\r\n                return StorageObject.deserialize<T>(obj);\r\n            }\r\n            catch (ex) {\r\n                L2.handleException(ex);\r\n                //ICE.HandleJavascriptError(ex, null, { Src: \"ProcessRequest::Get\", Store: storeName, Key: key, Progress: progress, RemainingSpace: store.remainingSpace/*(only supported by IE)*/ });\r\n            }\r\n        } else {\r\n            try {\r\n                //if (value === BrowserStore.removeItemVal) {\r\n                //    store.removeItem(key);\r\n                //    return;\r\n                //}\r\n\r\n                // SET\r\n                obj = new StorageObject(value);\r\n                store.setItem(key, JSON.stringify(obj));\r\n            }\r\n            catch (ex) {\r\n                L2.handleException(ex);\r\n                //ICE.HandleJavascriptError(ex, null, { Src: \"ProcessRequest::Set\", Store: storeName, Key: key, Value: value, Progress: progress, RemainingSpace: store.remainingSpace/*(only supported by IE)*/ });\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n\r\n}\r\n\r\nclass StorageObject {\r\n\r\n    private isValueAndObject: boolean;\r\n    private value: any;\r\n\r\n    constructor(val: any) {\r\n        this.isValueAndObject = (typeof val === \"object\");\r\n        this.value = val;\r\n    }\r\n\r\n    public static deserialize<T>(val: any): T {\r\n        if (!val || typeof (val) === \"undefined\") return null;\r\n\r\n        var obj = JSON.parse(val);\r\n        //!if (obj.IsValueAnObject) return $.parseJSON(obj.Value);\r\n        return obj.value;\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\nexport default class L2 {\r\n\r\n    private static _customOutputMsgHandler: IL2OutputMessageHandler;\r\n\r\n    public static BrowserStore: { local<T>(key: string, value?: T): T, session<T>(key: string, value?: T): T };\r\n\r\n    static registerOutputMessageHandler(handler: IL2OutputMessageHandler) {\r\n        L2._customOutputMsgHandler = handler;\r\n    }\r\n\r\n    static info(msg: string, title?: string) {\r\n        if (L2._customOutputMsgHandler) L2._customOutputMsgHandler.info.apply(L2._customOutputMsgHandler, arguments);\r\n        else toastr.info(msg, title);\r\n    }\r\n\r\n    static success(msg: string, title?: string) {\r\n        if (L2._customOutputMsgHandler) L2._customOutputMsgHandler.success.apply(L2._customOutputMsgHandler, arguments);\r\n        else toastr.success(msg, title);\r\n    }\r\n\r\n    static exclamation(msg: string, title?: string) {\r\n        if (L2._customOutputMsgHandler) L2._customOutputMsgHandler.warning.apply(L2._customOutputMsgHandler, arguments);\r\n        else toastr.warning(msg, title);\r\n    }\r\n\r\n    static confirm(msg: string, title?: string): Promise<boolean> {\r\n        let args = arguments;\r\n        if (L2._customOutputMsgHandler) {\r\n            return L2._customOutputMsgHandler.confirm.apply(L2._customOutputMsgHandler, args);\r\n        }\r\n\r\n        return new Promise<boolean>((resolve, reject) => {\r\n            reject(false); // currenly no default implementation\r\n        });\r\n    }\r\n\r\n    static handleException(error: Error | ExceptionInformation | string, additionalKVs?: Object) {\r\n        if (L2._customOutputMsgHandler) L2._customOutputMsgHandler.handleException.apply(L2._customOutputMsgHandler, arguments);\r\n        else {\r\n            toastr.error(error.toString());\r\n            console.error(error); // TODO: Log to DB\r\n        }\r\n\r\n    }\r\n\r\n    // https://gomakethings.com/vanilla-javascript-version-of-jquery-extend/\r\n    // Pass in the objects to merge as arguments.\r\n    // For a deep extend, set the first argument to `true`.\r\n    static extend(...any) {\r\n        var extended = {};\r\n        var deep = false;\r\n        var i = 0;\r\n        var length = arguments.length;\r\n\r\n        // Check if a deep merge\r\n        if (Object.prototype.toString.call(arguments[0]) === '[object Boolean]') {\r\n            deep = arguments[0];\r\n            i++;\r\n        }\r\n\r\n        // Merge the object into the extended object\r\n        var merge = function (obj) {\r\n            for (var prop in obj) {\r\n                if (Object.prototype.hasOwnProperty.call(obj, prop)) {\r\n                    // If deep merge and property is an object, merge properties\r\n                    if (deep && Object.prototype.toString.call(obj[prop]) === '[object Object]') {\r\n                        extended[prop] = this.extend(true, extended[prop], obj[prop]);\r\n                    } else {\r\n                        extended[prop] = obj[prop];\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        // Loop through each object and conduct a merge\r\n        for (; i < length; i++) {\r\n            var obj = arguments[i];\r\n            merge(obj);\r\n        }\r\n\r\n        return extended;\r\n\r\n    };\r\n\r\n\r\n    static clientIP(): Promise<string> {\r\n        return new Promise<string>((resolve, reject) => {\r\n            fetch(`${jsDAL.Server.serverUrl}/api/util/clientip`)\r\n                .then((r) => {\r\n                    if (r.status >= 200 && r.status < 300) { return r; }\r\n                    else { resolve(null); }\r\n                })\r\n                .then((r: any) => {\r\n                    resolve(r);\r\n                }).catch(e => resolve(null));\r\n        });\r\n    }\r\n}\r\n\r\ndelete L2.BrowserStore;\r\n(<any>L2).BrowserStore = BrowserStore; // don't know the correct TS way"]}