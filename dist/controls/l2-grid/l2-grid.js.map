{"version":3,"file":"l2-grid.js","sourceRoot":"","sources":["../../../L2-Lib/controls/l2-grid/l2-grid.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, Input, Output, EventEmitter, Directive, QueryList, ContentChildren, AfterContentInit, ViewContainerRef, TemplateRef, ChangeDetectionStrategy, ChangeDetectorRef } from '@angular/core';\r\nimport { Observable } from 'rxjs/Observable';\r\n\r\nimport { jsDAL } from '../../L2.DAL';\r\n\r\n\r\n@Directive({ selector: 'column' })\r\nexport class L2GridColumn {\r\n    @Input() bound: string = null;\r\n    @Input() display: string = null;\r\n\r\n\r\n}\r\n\r\n \r\nexport class L2GridTemplateColumnRow {\r\n    constructor(/*public $implicit: anypublic $implicit: any, public index: number, public count: number*/) {\r\n    }\r\n}\r\n\r\n@Directive({\r\n    selector: '[templatecolumn]', //inputs: [ 'row', 'index' ]\r\n    inputs: [ 'bound', 'display'],\r\n    providers: [{ provide: L2GridColumn, useExisting: L2GridTemplateColumn }] // 'cheat' so that  @ContentChildren(L2GridColumn) picks up this column type as well\r\n\r\n})\r\nexport class L2GridTemplateColumn {\r\n    @Input() bound: string = null;\r\n    @Input() display: string = null;\r\n\r\n    constructor(private templateRef: TemplateRef<L2GridTemplateColumnRow>) {\r\n    }\r\n}\r\n\r\n\r\n@Directive({ selector: 'columns' })\r\nexport class L2GridColumnCollection implements AfterContentInit {\r\n    @ContentChildren(L2GridColumn) columnList: QueryList<L2GridColumn>;\r\n\r\n    ngAfterContentInit() {\r\n    }\r\n}\r\n\r\n\r\n@Directive({ selector: 'no-results' })\r\nexport class L2GridNoResults {\r\n\r\n}\r\n\r\ndeclare var require:any;\r\n\r\n@Component({\r\n    selector: 'l2-grid',\r\n    template: require('./l2-grid.html'), // temporary solution until I figure out how to compile and package this project properly\r\n    styles: [ require('./l2-grid.css')],\r\n    //templateUrl: './l2-grid.html',\r\n    //styleUrls: ['./l2-grid.css'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class L2Grid implements AfterContentInit {\r\n\r\n    private _dataSource: any = null;\r\n    private _sproc: jsDAL.Sproc;\r\n    private isDataBound: boolean = false;\r\n    private _autoExecute: boolean = true;\r\n    private _isLoading: boolean = false;\r\n    private _lastDurationInMilliseconds: number;\r\n\r\n    @Input() public showHeaderStats: boolean = false;\r\n    @Input() public showFooterStats: boolean = true;\r\n\r\n    get dataSource(): any { return this._dataSource; }\r\n\r\n    set isLoading(v: boolean) { this._isLoading = v; this.changeDetectorRef.markForCheck(); }\r\n    get isLoading(): boolean {\r\n        return this._isLoading;\r\n    }\r\n\r\n    set lastDurationInMilliseconds(val: number) { this._lastDurationInMilliseconds = val; }\r\n    get lastDurationInMilliseconds(): number { return this._lastDurationInMilliseconds; }\r\n\r\n    @Input() set dataSource(value: any) {\r\n\r\n        if (jsDAL.Sproc.looksLikeADuck(value)) {\r\n            this.sproc = value;\r\n        }\r\n        else {\r\n            this._dataSource = value;\r\n            if (value != null) this.isDataBound = true;\r\n\r\n            this.changeDetectorRef.markForCheck();\r\n        }\r\n    }\r\n\r\n    @Input() set autoExecute(value: boolean) {\r\n        this._autoExecute = value;\r\n    }\r\n\r\n    private set sproc(value: jsDAL.Sproc) {\r\n\r\n        this._sproc = value;\r\n        if (!this.isLoading) {\r\n            this.isLoading = this._sproc.isLoading;\r\n        }\r\n        this._sproc.then(r => {\r\n            this.lastDurationInMilliseconds = this._sproc.lastExecutionTime;\r\n            if (!r.Message) {\r\n                this._dataSource = r.Data.Table0;\r\n                this.isDataBound = true;\r\n            }\r\n            else {\r\n                this._dataSource = [];\r\n                this.isDataBound = true;\r\n            }\r\n            this._isLoading = false;\r\n\r\n            this.changeDetectorRef.markForCheck();\r\n\r\n        }).catch(e => {\r\n            this._isLoading = false;\r\n            throw e;\r\n        });\r\n    }\r\n\r\n    get autoExecute(): boolean {\r\n        return this._autoExecute;\r\n    }\r\n\r\n    ngOnInit() {\r\n        // if we source our data from a Sproc rather than static data\r\n        if (this._sproc) {\r\n            if (this.autoExecute) {\r\n                this._isLoading = true;\r\n                this._sproc.ExecQuery();\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n\r\n\r\n\r\n    @ContentChildren(L2GridColumnCollection) columnCollections: QueryList<L2GridColumnCollection>;\r\n\r\n    constructor(private viewContainerRef: ViewContainerRef, private changeDetectorRef: ChangeDetectorRef) {\r\n    }\r\n\r\n\r\n    private getColumnNames(): string[] {\r\n        \r\n        \r\n        if (this.columnCollections == null) return null;\r\n        return this.columnCollections.first.columnList.map(c => c.display ? c.display : \"\");\r\n    }\r\n\r\n\r\n    ngAfterContentInit() {\r\n        if (this.columnCollections && this.columnCollections.length > 1) throw new Error(\"You may have only one <columns> element.\");\r\n    }\r\n\r\n    private getFieldData(col: L2GridColumn, row: any) {\r\n\r\n        var ret = row[col.bound];\r\n\r\n        if (ret === undefined) return \"\";\r\n        else return ret;\r\n    }\r\n}\r\n"]}